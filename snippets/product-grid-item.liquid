{% if product.compare_at_price > product.price %}
  {% assign product_on_sale = true %}
{% else %}
  {% assign product_on_sale = false %}
{% endif %}

<div
  class="collection__item product-item {% unless product.available %}product-item--sold-out{% endunless %} grid__cell 1/{{ settings.mobile_grid_items_per_row }} 1/{{ settings.tablet_grid_items_per_row }}--handheld 1/{{ grid_items_per_row }}--lap-and-up"
>
  <div class="product-item__inner">
    <div class="product-item__labels">
      {% if product.available and show_quick_shop %}
        <div class="product-item__label product-item__label--hidden">
          <button
            class="label label--quick-shop"
            data-action="open-quick-shop"
            data-quick-shop-url="{{ product.url | append: '?view=quick_shop' }}"
          >
            {% include 'icon' with 'cart-empty' -%}
            {{- 'product.labels.quick_shop' | t }}
          </button>
        </div>
      {% endif %}

      {% for tag in product.tags %}
        {% if tag contains '__label' %}
          <div class="product-item__label">
            <span class="label label--custom">{{ tag | split: '__label:' | last }}</span>
          </div>
          {% break %}
        {% endif %}
      {% endfor %}

      {% if product_on_sale %}
        {% comment %}
          <div class="product-item__label">
            <span class="label label--on-sale">{{ 'product.labels.on_sale' | t }}</span>
          </div>
        {% endcomment %}
      {% elsif product.available == false %}
        <div class="product-item__label">
          <span class="label label--sold-out">{{ 'product.labels.sold_out' | t }}</span>
        </div>
      {% endif %}
    </div>

    <a href="{{ shop.url }}{{ product.url }}" class="product-item__image">
      <div class="product-item__image-wrapper">
        {% if product.featured_image %}
          {% assign main_image = product.featured_image %}
        {% elsif product.images.size > 0 %}
          {% assign main_image = product.images[0] %}
          {% comment %} {% assign main_image = product.images | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %} {% endcomment %}
        {% endif %}

        {% if main_image %}
          {% include 'image-size', sizes: '200,300,400,600,800,900,1000', image: main_image %}
          {% assign image_url = main_image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %}

          <div
            class="aspect-ratio"
            style="padding-bottom: {{ 100.0  }}%"
          >
            <img
              class="lazyload image--fade-in"
              data-sizes="auto"
              data-src="{{ image_url }}"
              data-widths="[{{ supported_sizes }}]"
              alt="{{ main_image.alt }}"
            >

            <noscript>
              <img src="{{ main_image | img_url: '600x' }}" alt="{{ main_image.alt }}">
            </noscript>
          </div>
        {% else %}
          empty
        {% endif %}
      </div>
    </a>

    <div class="product-item__info">
      {% if show_vendor and product.vendor != blank %}
        <h3 class="product-item__vendor">
          <a href="{{ product.vendor | url_for_vendor }}">{{ product.vendor }}</a>
        </h3>
      {% endif %}

      <div class="product-item__title ellipsis-1">
        <a href="{{ shop.url }}{{ product.url }}">{{ product.title }}</a>
      </div>

      <div>
        {% if product_on_sale %}
          <span class="product-item__price product-item__price--new" data-money-convertible>
            {{- product.price | money -}}
          </span>
          <span class="product-item__price product-item__price--old" data-money-convertible>
            {{- product.compare_at_price | money -}}
          </span>
        {% elsif product.price_varies %}
          {% assign formatted_min_price = product.price_min | money %}
          <span class="product-item__price">
            {{- 'collection.product.from_price_html' | t: price: formatted_min_price -}}
          </span>
        {% else %}
          <span class="product-item__price" data-money-convertible>
            {{- product.price | default: product.price | money -}}
          </span>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% style %}
  .ellipsis-1 {
    display: -webkit-box; /* 必须 */
    -webkit-box-orient: vertical; /* 必须 */
    -webkit-line-clamp: 1; /* 将 N 替换为需要的行数，如 2、3 */
    overflow: hidden; /* 必须 */
    text-overflow: ellipsis; /* 末尾显示省略号 */
    width: 100%; /* 建议设置宽度（或最大宽度） */
    line-height: 1.5; /* 建议设置行高，便于高度与行数匹配 */
  }
{% endstyle %}
